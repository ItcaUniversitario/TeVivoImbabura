<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TE VIVO IMBABURA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora&display=swap" rel="stylesheet">

    <style>
        /* Estilos generales */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .dashboard-container {
            width: 90%;
            max-width: 1000px;
            height: 90vh;
            max-height: 700px;
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        header {
            padding: 15px 25px;
            text-align: center;
            background-color: #f39a1e;
            color: rgb(10, 10, 10);
        }

        header h1 {
            margin: 0;
            font-size: 1.8em;
            letter-spacing: 2px;
        }

        main {
            flex-grow: 1;
            position: relative;
        }

        /* Sistema de Pantallas */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: white;
        }

        .screen.active {
            opacity: 1;
            pointer-events: auto;
        }

        #video-screen {
            background-color: black;
        }

        #youtube-player {
            width: 100%;
            height: 100%;
            position: relative;
            z-index: 5;
        }

        #map-screen {
            padding: 0;
            position: relative;
        }

        #map-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }


        /* === ESTILOS MEJORADOS PARA EL MODAL DE REGISTRO === */

        /* El fondo oscuro que contiene el modal */
        #registration-modal-backdrop {
            position: absolute;
            /* Correcto para que se contenga dentro del dashboard */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;

            z-index: 1000;
            display: none;
            justify-content: flex-end;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        /* El contenedor del formulario */
        #registration-modal {
            background-color: #f9f9f9;
            /* Un fondo blanco menos intenso */
            padding: 30px;
            border-radius: 12px;
            /* Bordes más redondeados y suaves */
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.1);
            /* Sombra más sutil */
            width: 100%;
            max-width: 380px;
            /* Un tamaño ligeramente ajustado */
            text-align: left;
            max-height: 90vh;
            /* Se asegura que el modal no sea más alto que la pantalla */
            overflow-y: auto;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            /* Tipografía moderna */
        }

        /* Actualización para una versión ultracompacta */

        /* 1. Reducimos el padding general del modal */
        #registration-modal {
            background-color: #f9f9f9;
            padding: 15px 20px;
            /* Reducido de 20px 25px */
            border-radius: 10px;
            /* Ligeramente menos redondeado */
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 320px;
            text-align: left;
            max-height: 90vh;
            overflow-y: auto;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        /* 2. Reducimos el tamaño y margen del título */
        #registration-modal h2 {
            margin-top: 0;
            margin-bottom: 12px;
            /* Reducido de 15px */
            text-align: center;
            color: #333;
            font-size: 1.3em;
            /* Tamaño de fuente ligeramente reducido */
            font-weight: 600;
        }

        /* 3. Hacemos la etiqueta más pequeña y la acercamos al campo */
        #registration-modal label {
            display: block;
            margin-bottom: 3px;
            /* Reducido de 4px */
            font-weight: 600;
            font-size: 0.8em;
            /* Tamaño de fuente reducido */
            color: #555;
        }

        /* 4. Hacemos los campos de entrada lo más compactos posible */
        #registration-modal input,
        #registration-modal select {
            width: 100%;
            padding: 7px 10px;
            /* Padding vertical reducido a 7px */
            margin-bottom: 10px;
            /* Reducido de 12px */
            border: 1px solid #ddd;
            border-radius: 6px;
            /* Bordes menos redondeados */
            box-sizing: border-box;
            background-color: #fff;
            font-size: 0.9em;
            /* Texto interior más pequeño */
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        /* 5. Compactamos el botón final */
        #registration-modal button {
            width: 100%;
            padding: 9px;
            /* Reducido de 10px */
            border: none;
            border-radius: 6px;
            background-color: #28a745;
            color: white;
            font-size: 1em;
            /* Tamaño de fuente reducido */
            font-weight: bold;
            cursor: pointer;
            margin-top: 5px;
            /* Reducido de 8px */
            transition: background-color 0.3s, transform 0.2s;
        }

        /* Contenedor para el encabezado del modal */
        .modal-header {
            display: flex;
            /* Activa el modo de alineación flexible */
            justify-content: space-between;
            /* Empuja el título a la izquierda y el botón a la derecha */
            align-items: center;
            /* Centra verticalmente ambos elementos */
            width: 100%;
            margin-bottom: 15px;
            /* Mantiene el espacio con el formulario */
        }

        /* Ajuste al título para que funcione con flexbox */
        #registration-modal .modal-header h2 {
            margin: 0;
            /* Quitamos el margen por defecto del h2 */
            flex-grow: 1;
            /* Permite que el título ocupe el espacio disponible */
            text-align: left;
            /* Alineamos el texto a la izquierda dentro de su espacio */
        }

        /* Estilos para el botón de configuración */
        .settings-button {
            display: inline-block;
            padding: 5px;
            line-height: 0;
            /* Evita que el contenedor sea más alto que el ícono */
            text-decoration: none;
            /* Le quita el subrayado de enlace */
            border-radius: 50%;
            /* Lo hace circular */
            transition: background-color 0.3s;
        }

        /* Estilos para el ícono SVG dentro del botón */
        .settings-button svg {
            width: 22px;
            /* Tamaño del ícono */
            height: 22px;
            fill: #888;
            /* Color gris suave para el ícono */
            transition: fill 0.3s;
        }

        /* Efecto al pasar el mouse por encima del botón */
        .settings-button:hover {
            background-color: #e9e9e9;
            /* Un fondo suave aparece al pasar el mouse */
        }

        .settings-button:hover svg {
            fill: #333;
            /* El ícono se oscurece */
        }


        /* --- ESTILOS PARA EL MODAL DE SELECCIÓN DE FICHA --- */

        #ficha-modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: transparent;
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        #ficha-modal {
            background-color: white;
            padding: 30px 40px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .ficha-choices {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .ficha-option {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #eee;
        }

        .ficha-option:hover {
            transform: scale(1.1);
            border-color: #a7c7e7;
        }

        /* --- ESTILOS PARA EL DADO --- */
        #dice-container {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: transparent;
            z-index: 50;
        }

        #player-ficha {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            z-index: 40;
            display: none;

            /* --- LÍNEA AJUSTADA PARA MOVER A LA IZQUIERDA --- */
            /* Centra la ficha y la mueve 15px extra a la izquierda. */
            transform: translate(calc(-50% - 10px), -50%);
            /* <-- AJUSTA LOS 15px SI ES NECESARIO */

            background-size: 50%;
            background-repeat: no-repeat;
            background-position: center;
            background-color: transparent;
            border: 1px solid rgba(0, 0, 0, 0.2);
        }

        /* --- ESTILOS DADO --- */

        #dice-face {
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            }

            50% {
                transform: scale(1.1);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.7);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            }
        }

        .dice-ready {
            animation: pulse 2s infinite;
        }

        .dice-face {
            width: 70px;
            height: 70px;
            background-color: #f8f8f8;
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 6px;
            box-sizing: border-box;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .dot {
            width: 15px;
            height: 15px;
            background-color: #333;
            border-radius: 50%;
            align-self: center;
            justify-self: center;
            visibility: hidden;
        }

        .face-1 .dot:nth-child(1) {
            grid-column: 1 / 3;
            grid-row: 2;
            visibility: visible;
        }

        .face-2 .dot:nth-child(1) {
            grid-column: 1;
            grid-row: 1;
            visibility: visible;
        }

        .face-2 .dot:nth-child(2) {
            grid-column: 2;
            grid-row: 3;
            visibility: visible;
        }

        .face-3 .dot:nth-child(1) {
            grid-column: 1;
            grid-row: 1;
            visibility: visible;
        }

        .face-3 .dot:nth-child(2) {
            grid-column: 1 / 3;
            grid-row: 2;
            visibility: visible;
        }

        .face-3 .dot:nth-child(3) {
            grid-column: 2;
            grid-row: 3;
            visibility: visible;
        }

        .face-4 .dot:nth-child(1) {
            grid-column: 1;
            grid-row: 1;
            visibility: visible;
        }

        .face-4 .dot:nth-child(2) {
            grid-column: 2;
            grid-row: 1;
            visibility: visible;
        }

        .face-4 .dot:nth-child(3) {
            grid-column: 1;
            grid-row: 3;
            visibility: visible;
        }

        .face-4 .dot:nth-child(4) {
            grid-column: 2;
            grid-row: 3;
            visibility: visible;
        }

        .face-5 .dot:nth-child(1) {
            grid-column: 1;
            grid-row: 1;
            visibility: visible;
        }

        .face-5 .dot:nth-child(2) {
            grid-column: 2;
            grid-row: 1;
            visibility: visible;
        }

        .face-5 .dot:nth-child(3) {
            grid-column: 1 / 3;
            grid-row: 2;
            visibility: visible;
        }

        .face-5 .dot:nth-child(4) {
            grid-column: 1;
            grid-row: 3;
            visibility: visible;
        }

        .face-5 .dot:nth-child(5) {
            grid-column: 2;
            grid-row: 3;
            visibility: visible;
        }

        .face-6 .dot:nth-child(1) {
            grid-column: 1;
            grid-row: 1;
            visibility: visible;
        }

        .face-6 .dot:nth-child(2) {
            grid-column: 2;
            grid-row: 1;
            visibility: visible;
        }

        .face-6 .dot:nth-child(3) {
            grid-column: 1;
            grid-row: 2;
            visibility: visible;
        }

        .face-6 .dot:nth-child(4) {
            grid-column: 2;
            grid-row: 2;
            visibility: visible;
        }

        .face-6 .dot:nth-child(5) {
            grid-column: 1;
            grid-row: 3;
            visibility: visible;
        }

        .face-6 .dot:nth-child(6) {
            grid-column: 2;
            grid-row: 3;
            visibility: visible;
        }

        #map-screen {
            position: relative;
            overflow: hidden;
        }

        #map-zoom-container {
            position: relative;
            width: 100%;
            max-width: 1000px;
            margin: auto;

            /* --- TUS MEDIDAS EXACTAS AQUÍ --- */
            aspect-ratio: 10667 / 6000;

            transition: transform 2s ease-in-out;
        }

        .zoomed-in {
            transform: scale(2.5) translateX(-20%) translateY(-10%);
        }

        /* --- ESTILOS UNIFICADOS PARA TODOS LOS MODALES --- */
        .modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        #event-modal-backdrop.no-shadow-backdrop {
            background-color: transparent;
        }

        .modal-content {
            background-color: white;
            padding: 25px 35px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            text-align: center;
            width: 90%;
            max-width: 450px;
            transform: scale(0.9);
            transition: transform 0.4s ease;
            max-height: 90%;
            overflow-y: auto;
            box-sizing: border-box;
        }

        .modal-backdrop.visible {
            opacity: 1;
        }

        .modal-backdrop.visible .modal-content {
            transform: scale(1);
        }

        .modal-content h2 {
            color: #a7c7e7;
            font-size: 1.6em;
            margin-top: 0;
            margin-bottom: 15px;
        }

        #info-modal-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .modal-content p {
            font-size: 1.1em;
            color: #333;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .modal-content .inline-reward-icon {
            width: 24px;
            height: 24px;
            vertical-align: middle;
            margin: 0 5px;
        }

        #event-icon-container {
            width: 50px;
            height: auto;
            margin: 20px auto;
        }

        #event-icon-container svg {
            fill: #FFC107;
            /* Color del ícono de trofeo */
        }

        .modal-content button {
            padding: 10px 25px;
            background-color: #8bc34a;
            color: white;
            border: none;
            border-radius: 7px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .modal-content button:hover {
            background-color: #7cb342;
        }

        #event-modal-close-button .fas {
            margin-right: 8px;
        }

        #question-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-button {
            width: 100%;
            padding: 12px;
            font-size: 1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: #f8f8f8;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-button:hover:not(:disabled) {
            background-color: #e9e9e9;
            border-color: #a7c7e7;
        }

        .option-button.correct {
            background-color: #c8e6c9;
            border-color: #4caf50;
            color: #2e7d32;
            font-weight: bold;
        }

        .option-button.incorrect {
            background-color: #ffcdd2;
            border-color: #f44336;
            color: #c62828;
        }

        #question-feedback {
            min-height: 20px;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        #score-container {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 50;
            min-width: 100px;
        }

        #score-label {
            font-size: 0.8em;
            font-weight: bold;
            color: #555;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        #score-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
        }

        #inventory-container {
            position: absolute;
            top: 115px;
            left: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 50;
            min-width: 100px;
        }

        #inventory-label {
            font-size: 0.8em;
            font-weight: bold;
            color: #555;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        #inventory-icons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .inventory-slot {
            position: relative;
            width: 40px;
            height: 40px;
            background-color: #e0e0e0;
            border-radius: 8px;
            padding: 6px;
            box-sizing: border-box;
            opacity: 0.4;
            transition: all 0.3s ease;
        }

        .inventory-slot.collected {
            opacity: 1;
            background-color: #fffbe0;
        }

        .inventory-slot img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .item-count {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background-color: #ffb347;
            color: white;
            font-size: 10px;
            font-weight: bold;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .scan-instruction {
            display: none;
            margin: 15px 0;
            padding: 10px;
            background-color: #f0f8ff;
            border-radius: 8px;
            border: 1px dashed #a7c7e7;
            align-items: center;
            justify-content: center;
        }

        .scanner-icon {
            margin-right: 10px;
        }

        .reward-display {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            padding: 8px 12px;
            background-color: #fffbe0;
            border: 1px solid #ffecb3;
            border-radius: 8px;
        }

        .reward-text {
            font-weight: bold;
            color: #f57c00;
        }

        .reward-icon {
            width: 32px;
            height: 32px;
        }


        /* --- ESTILOS PARA LA PANTALLA DE ADMINISTRADOR --- */
#admin-screen {
    flex-direction: column;
    background-color: #f0f2f5;
    padding: 20px;
    box-sizing: border-box;
}

.admin-container {
    width: 100%;
    max-width: 1200px;
    height: 100%;
    display: flex;
    flex-direction: column;
}

#admin-screen h1 {
    text-align: center;
    color: #333;
    margin-bottom: 20px;
}

.table-wrapper {
    flex-grow: 1;
    overflow-y: auto; /* Permite scroll solo en la tabla */
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

#admin-screen table {
    width: 100%;
    border-collapse: collapse;
}

#admin-screen th, #admin-screen td {
    padding: 12px 15px;
    border: 1px solid #ddd;
    text-align: left;
}

#admin-screen th {
    background-color: #f39a1e;
    color: white;
    position: sticky; /* Encabezados fijos al hacer scroll */
    top: 0;
}

#admin-screen tbody tr:nth-child(even) {
    background-color: #f9f9f9;
}

#loading-message {
    text-align: center;
    font-size: 1.2em;
    color: #777;
    padding: 40px;
}

#back-to-game-btn {
    margin-top: 20px;
    padding: 12px 30px;
    align-self: center; /* Centra el botón */
    border: none;
    border-radius: 8px;
    background-color: #555;
    color: white;
    font-size: 1em;
    cursor: pointer;
    transition: background-color 0.3s;
}

#back-to-game-btn:hover {
    background-color: #333;
}
    </style>
</head>

<body>

    <div class="dashboard-container">
        <header>
            <h1>TE VIVO IMBABURA</h1>
        </header>
        <main>

            <div id="video-screen" class="screen active">
                <div id="youtube-player"></div>
            </div>

            <div id="map-screen" class="screen">

                <div id="map-zoom-container">
                    <img id="map-image" src="mapa_imbabura.jpeg" alt="Mapa del Juego Interactivo">
                    <div id="player-ficha"></div>
                </div>

                <div id="score-container">
                    <div id="score-label">PUNTUACIÓN</div>
                    <div id="score-value">0</div>
                </div>

                <div id="inventory-container">
                    <div id="inventory-label">RECOMPENSAS</div>
                    <div id="inventory-icons">
                        <div class="inventory-slot" id="item-helado"><img src="icon_helado.png" alt="Helado"><span
                                class="item-count">0</span></div>
                        <div class="inventory-slot" id="item-arbol"><img src="icon_arbol.png" alt="Arbol"><span
                                class="item-count">0</span></div>
                        <div class="inventory-slot" id="item-algodon"><img src="icon_algodon.png" alt="Algodon"><span
                                class="item-count">0</span></div>
                        <div class="inventory-slot" id="item-poncho"><img src="icon_poncho.png" alt="Poncho"><span
                                class="item-count">0</span></div>
                        <div class="inventory-slot" id="item-canoa"><img src="icon_barco.png" alt="Canoa"><span
                                class="item-count">0</span></div>
                    </div>
                </div>

                <div id="dice-container">
                    <div id="dice-face" class="dice-face face-1">
                        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
                        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
                    </div>
                </div>
            </div>

            <div id="admin-screen" class="screen">
    <div class="admin-container">
        <h1>Registros de Jugadores</h1>
        <p id="loading-message">Cargando datos desde Firebase...</p>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Cédula</th>
                        <th>Nombres y Apellidos</th>
                        <th>Edad</th>
                        <th>Género</th>
                        <th>Ciudad</th>
                        <th>Correo Electrónico</th>
                        <th>Teléfono</th>
                    </tr>
                </thead>
                <tbody id="registros-tbody">
                    </tbody>
            </table>
        </div>
        <button id="back-to-game-btn">Volver al Juego</button>
    </div>
</div>

            <div id="registration-modal-backdrop">
                <div id="registration-modal">
                    <div class="modal-header">
                        <h2>Registro de Jugador</h2>
                        <a href="#" id="admin-login-trigger" class="settings-button" title="Administrador">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.23 C14.38,2,14.17,1.84,13.92,1.84h-3.84c-0.25,0-0.46,0.16-0.49,0.39l-0.34,2.55c-0.58,0.23-1.12,0.55-1.62,0.93L5.24,4.75 c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.29C2.62,8.49,2.68,8.76,2.86,8.9l2.03,1.58C4.84,10.8,4.82,11.1,4.82,11.4 c0,0.3,0.02,0.6,0.06,0.9l-2.03,1.58c-0.18,0.14-0.24,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22 l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.34,2.55c0.02,0.24,0.23,0.4,0.49,0.4h3.84c0.25,0,0.46-0.16,0.49-0.39 l0.34-2.55c0.58-0.23,1.12-0.55,1.62-0.93l2.39,0.96c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32 c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6 S13.98,15.6,12,15.6z" />
                            </svg>
                        </a>
                    </div>
                    <form id="registration-form">
                        <label for="playerCedula">Cédula:</label>
                        <input type="text" id="playerCedula" name="playerCedula" autocomplete="off" maxlength="10">

                        <label for="playerName">Nombres y Apellidos:</label>
                        <input type="text" id="playerName" name="playerName" autocomplete="off">

                        <label for="playerAge">Edad:</label>
                        <input type="number" id="playerAge" name="playerAge" min="1">

                        <label for="playerGender">Género:</label>
                        <select id="playerGender" name="playerGender">
                            <option value="" disabled selected>Selecciona una opción</option>
                            <option value="masculino">Masculino</option>
                            <option value="femenino">Femenino</option>
                            <option value="otro">Otro</option>
                        </select>

                        <label for="playerCity">Ciudad:</label>
                        <input type="text" id="playerCity" name="playerCity" autocomplete="off">

                        <label for="playerEmail">Correo Electrónico:</label>
                        <input type="email" id="playerEmail" name="playerEmail" autocomplete="off">

                        <label for="playerPhone">Teléfono:</label>
                        <input type="tel" id="playerPhone" name="playerPhone">

                        <button type="submit" disabled>Jugar</button>
                    </form>
                </div>
            </div>
<div id="admin-login-backdrop" class="modal-backdrop">
    <div id="admin-login-modal" class="modal-content">
        
        <button id="close-admin-modal-btn" class="settings-button" title="Cerrar" style="position: absolute; top: 15px; right: 15px;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/>
            </svg>
        </button>

        <h1>Acceso de Administrador</h1>
        <form id="admin-login-form" style="text-align: left; margin-top: 25px;">
            <div style="margin-bottom: 15px;">
                <label for="admin-email" style="display: block; margin-bottom: 5px; font-weight: bold;">Correo Electrónico:</label>
                <input type="email" id="admin-email" name="email" required autocomplete="off" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;">
            </div>
            <div style="margin-bottom: 20px;">
                <label for="admin-password" style="display: block; margin-bottom: 5px; font-weight: bold;">Contraseña:</label>
                <input type="password" id="admin-password" name="password" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;">
            </div>
            <button type="submit" style="width: 100%; padding: 12px; font-size: 1.1em;">Ingresar</button>
        </form>
    </div>
</div>

            <div id="info-modal-backdrop" class="modal-backdrop">
                <div id="info-modal" class="modal-content">
                    <h2 id="info-modal-title"></h2>
                    <div class="info-modal-visual">
                        <img id="info-modal-image" src="" alt="Lugar de interés">
                        <div class="scan-instruction">
                            <svg class="scanner-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 7V5a2 2 0 0 1 2-2h2"></path>
                                <path d="M17 3h2a2 2 0 0 1 2 2v2"></path>
                                <path d="M21 17v2a2 2 0 0 1-2 2h-2"></path>
                                <path d="M7 21H5a2 2 0 0 1-2-2v-2"></path>
                                <line x1="7" y1="12" x2="17" y2="12"></line>
                            </svg>
                            <span>¡Es necesario escanear la imagen con tu celular!</span>
                        </div>
                    </div>

                    <div class="info-modal-text">

                        <p id="info-modal-description"></p>
                        <div class="reward-display" id="info-modal-reward">
                            <span class="reward-text">¡Recompensa!</span>
                            <img class="reward-icon" src="" alt="Recompensa">
                        </div>
                        <button id="info-modal-close-button">Continuar</button>
                    </div>

                </div>
            </div>

            <div id="reward-modal-backdrop" class="modal-backdrop">
                <div id="reward-modal" class="modal-content">
                    <h2 id="reward-modal-title"></h2>
                    <p id="reward-modal-description"></p>
                    <div class="reward-display" id="reward-modal-reward">
                        <span class="reward-text">¡Recompensa!</span>
                        <img class="reward-icon" src="" alt="Recompensa">
                    </div>
                    <button id="reward-modal-close-button">Continuar</button>
                </div>
            </div>

            <div id="question-modal-backdrop" class="modal-backdrop">
                <div id="question-modal" class="modal-content">
                    <h2 id="question-title">¡Pregunta Sorpresa!</h2>
                    <p id="question-text"></p>
                    <div id="question-options"></div>
                    <p id="question-feedback"></p>
                    <div class="reward-display" id="question-modal-reward">
                        <span class="reward-text">¡Recompensa!</span>
                        <img class="reward-icon" src="" alt="Recompensa">
                    </div>
                    <button id="question-continue-button" style="display: none;">Continuar Aventura</button>
                </div>
            </div>

            <div id="event-modal-backdrop" class="modal-backdrop">
                <div id="event-modal" class="modal-content">
                    <p id="event-text"></p>
                    <div id="event-icon-container"></div>
                    <button id="event-modal-close-button">Entendido</button>
                </div>
            </div>

            <div id="ficha-modal-backdrop">
                <div id="ficha-modal">
                    <h2>Elige tu ficha</h2>
                    <div class="ficha-choices">
                        <img src="https://placehold.co/80x80/3498DB/FFFFFF?text=H" alt="Hombre" class="ficha-option"
                            data-ficha="hombre">
                        <img src="https://placehold.co/80x80/E74C3C/FFFFFF?text=M" alt="Mujer" class="ficha-option"
                            data-ficha="mujer">
                        <img src="https://placehold.co/80x80/2ECC71/FFFFFF?text=A" alt="Animal" class="ficha-option"
                            data-ficha="animal">
                        <img src="https://placehold.co/80x80/F1C40F/FFFFFF?text=S" alt="Sol" class="ficha-option"
                            data-ficha="sol">
                        <img src="https://placehold.co/80x80/9B59B6/FFFFFF?text=L" alt="Luna" class="ficha-option"
                            data-ficha="luna">
                        <img src="https://placehold.co/80x80/7F8C8D/FFFFFF?text=M" alt="Montaña" class="ficha-option"
                            data-ficha="montana">
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player;
        const youtubeVideoId = 'UW5IPJQKmiA';

        const path = [
            { top: '57.99%', left: '71.80%' },   // 0 (Salida)
            { top: '59.85%', left: '73.40%' },     // 1
            { top: '61.20%', left: '74.70%' },       // 2
            { top: '62.55%', left: '75.80%' },       // 3
            { top: '63.56%', left: '76.70%' },     // 4
            { top: '64.91%', left: '77.70%' },     // 5
            { top: '66.09%', left: '78.80%' },   // 6
            { top: '67.27%', left: '80.00%' },     // 7
            { top: '68.28%', left: '81.40%' },     // 8
            { top: '70.64%', left: '80.80%' },       // 9
            { top: '71.99%', left: '79.70%' },     // 10
            { top: '73.00%', left: '78.60%' },       // 11
            { top: '73.84%', left: '76.90%' },       // 12
            { top: '74.52%', left: '75.80%' },       // 13
            { top: '74.69%', left: '74.30%' },   // 14
            { top: '75.02%', left: '73.00%' },     // 15
            { top: '75.02%', left: '71.60%' },     // 16
            { top: '74.86%', left: '70.00%' },     // 17
            { top: '74.18%', left: '68.60%' },     // 18
            { top: '73.00%', left: '67.20%' },     // 19
            { top: '71.48%', left: '66.10%' },       // 20
            { top: '70.64%', left: '64.80%' },     // 21
            { top: '69.80%', left: '63.40%' },     // 22
            { top: '68.62%', left: '62.10%' },       // 23
            { top: '66.26%', left: '62.10%' },     // 24
            { top: '64.91%', left: '63.40%' },     // 25
            { top: '64.23%', left: '64.90%' },     // 26
            { top: '63.39%', left: '66.10%' },       // 27
            { top: '60.86%', left: '66.70%' },     // 28
            { top: '58.50%', left: '66.40%' },     // 29
            { top: '56.48%', left: '65.70%' },     // 30
            { top: '54.45%', left: '65.20%' },     // 31
            { top: '52.09%', left: '64.80%' },     // 32
            { top: '49.73%', left: '65.00%' },     // 33
            { top: '48.21%', left: '66.30%' },     // 34
            { top: '46.70%', left: '67.30%' },     // 35
            { top: '43.66%', left: '67.90%' },     // 36
            { top: '41.30%', left: '67.90%' },     // 37
        ];

        // --- ESTADO DEL JUEGO ---
        let playerPosition = 0;
        let playerScore = 0;
        let gameActive = false;
        let hasVideoFinished = false;
        let isRolling = false;
        let gameOver = false;
        let pendingMove = 0;
        let playerInventory = { helado: 0, arbol: 0, algodon: 0, poncho: 0, canoa: 0 };

        // --- DATOS DEL JUEGO ORGANIZADOS POR TIPO ---
        const gameData = {
            infoPoints: {
                '1': { title: "HELADOS IBARRA", image: "https://portalciudadano.ibarra.gob.ec/PortalCiudadano/_lib/file/img/portalturistico/informacionGeneral/miniaturas/L6-GT-HELADOS-CREMA.png", description: "Has llegado a la cuna de los famosos helados de paila. ¡Ganas 5 puntos y un helado!", pointsGained: 5, rewardId: 'helado' },
                '8': { title: "MIRADOR DE ANGOCHAGUA", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSbUK69X53V3Z1yHQ6vgXLTEQaBa8Xz3cGnsg&s", description: "Disfrutas de una vista espectacular desde el mirador Mucha Naju Rumi. ¡Ganas 5 puntos y un árbol!", pointsGained: 5, rewardId: 'arbol' },
                '18': { title: "PLAZA DE PONCHOS", image: "https://buentrip.app/panel/files/media/115881459_105519434582033_7780054256266361795_n.jpg", description: "Estás en el mercado artesanal más grande de Sudamérica. Ganas 5 puntos y un poncho.", pointsGained: 5, rewardId: 'poncho' },
                '23': { title: "LAGUNA DE CUICOCHA", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTtPep1KSP9aeDHFHu0U2Tb79gedVdWxfr-YA&s", description: "Navegas por la 'Laguna de los Dioses'. Ganas 5 puntos y una canoa.", pointsGained: 5, rewardId: 'canoa' },
                '28': { title: "FÁBRICA IMBABURA", image: "https://upload.wikimedia.org/wikipedia/commons/9/92/Ama_la_Vida_-_Flickr_-_Recorrido_ministra_SM_por_provincia_de_Imbabura_29-07-2014_%2817%29_%2814600253807%29.jpg", description: "Visitas el histórico complejo textil de Atuntaqui. Ganas 5 puntos y una muestra de algodón.", pointsGained: 5, rewardId: 'algodon' },
                '36': { title: "MONTAÑA DE LUZ", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRE-T8w299YnGo0OJyttGnTtQVgUQ-dtM5oiQ&s", description: "Llegas a un lugar de paz y sanación. ¡Ganas 10 puntos y un árbol simbólico!", pointsGained: 10, rewardId: 'arbol' },
            },
            rewardPoints: {
                '3': { title: "Dato Curioso", description: "Uno de los acompañantes más frecuentes en el consumo de los helados de paila es la quesadilla.", pointsGained: 5, rewardId: 'helado' },
                '5': { title: "Dato Curioso", description: "La producción y comercialización de helados dinamiza la agricultura y la economía locales.", pointsGained: 5, rewardId: 'helado' },
                '9': { title: "Dato Curioso", description: "El mirador Mucha Naju Rumi está a una altitud de 2880 msnm.", pointsGained: 5, rewardId: 'arbol' },
                '14': { title: "Dato Curioso", description: "Desde este mirador se pueden apreciar varios volcanes, tales como: Taita Imbabura, Cubilche, Cuzín.", pointsGained: 5, rewardId: 'arbol' },
                '16': { title: "Dato Curioso", description: "En el trayecto al mirador se pueden observar una variedad de plantas y árboles como: achupallas, alisos, eucaliptos.", pointsGained: 5, rewardId: 'arbol' },
                '20': { title: "Dato Cultural", description: "Alrededor de la plaza de ponchos se pueden encontrar espacios culturales para vivir las costumbres y tradiciones locales.", pointsGained: 5, rewardId: 'poncho' },
                '25': { title: "Dato Cultural", description: "En la Ruta Sagrada se pueden encontrar simbolismos de los pueblos originarios como la Chacana y el calendario lunar.", pointsGained: 5, rewardId: 'canoa' },
                '27': { title: "Dato Geográfico", description: "El estrecho entre los domos interiores de la caldera volcánica es conocido como Canal del Ensueño.", pointsGained: 5, rewardId: 'canoa' },
                '32': { title: "Dato Histórico", description: "La fecha de fundación de la Fábrica Imbabura es 1924.", pointsGained: 5, rewardId: 'algodon' },
                '34': { title: "Dato Histórico", description: "Fábrica Imbabura, en su época de apogeo dinamizó la producción agrícola de algodón de los valles de Salinas y el Chota.", pointsGained: 5, rewardId: 'algodon' },
            },
            questionPoints: {
                '4': { question: "¿Cuál es el nombre de la promotora de los helados de paila más reconocida?", options: ["María Chuga", "Rosalía Suárez", "Anita Benavides"], correctAnswer: 1, pointsGained: 5, pointsLost: 3, rewardId: 'helado', feedback: { correct: "¡Correcto! Rosalía Suárez es la pionera. Ganas 5 puntos y 1 Helado.", incorrect: "Respuesta incorrecta. La promotora más famosa es Rosalía Suárez. Pierdes 3 puntos." } },
                '7': { question: "¿Cuál es el instrumento más característico en la elaboración de los helados de paila?", options: ["Paila de cobre", "Banca de madera", "Congelador"], correctAnswer: 0, pointsGained: 5, pointsLost: 3, feedback: { correct: "¡Correcto! La paila de cobre es esencial. Ganas 5 puntos.", incorrect: "Incorrecto. El instrumento clave es la paila de cobre. Pierdes 3 puntos." } },
                '11': { question: "¿En qué lengua está escrito Mucha Naju Rumi?", options: ["Inglés", "Alemán", "Kichwa"], correctAnswer: 2, pointsGained: 5, pointsLost: 2, feedback: { correct: "¡Correcto! Está en Kichwa. Ganas 5 puntos.", incorrect: "Incorrecto. La lengua es Kichwa. Pierdes 2 puntos." } },
                '15': { question: "¿Conoces la traducción de Mucha Naju Rumi al español?", options: ["Lugar donde se besan las rocas", "Lugar donde se rompen las rocas", "Lugar donde brincan las rocas"], correctAnswer: 0, pointsGained: 5, pointsLost: 3, feedback: { correct: "¡Excelente! Significa 'Lugar donde se besan las rocas'. Ganas 5 puntos.", incorrect: "Incorrecto. La traducción es 'Lugar donde se besan las rocas'. Pierdes 3 puntos." } },
                '21': { question: "¿La plaza de ponchos de Otavalo es una de las ferias artesanales más grandes de América Latina?", options: ["Sí", "No"], correctAnswer: 0, pointsGained: 5, pointsLost: 3, feedback: { correct: "¡Así es! Es famosa en todo el continente. Ganas 5 puntos.", incorrect: "Incorrecto. Es una de las más grandes y famosas. Pierdes 3 puntos." } },
                '26': { question: "El domo interior más grande del lago Cuicocha, se llama:", options: ["Yaguarcocha", "Cuicocha", "Teodoro Wolf"], correctAnswer: 2, pointsGained: 5, pointsLost: 3, feedback: { correct: "¡Correcto! Se llama Teodoro Wolf. Ganas 5 puntos.", incorrect: "Incorrecto. El domo más grande es el Teodoro Wolf. Pierdes 3 puntos." } },
                '30': { question: "¿Sabes qué tipo de telas se producían especialmente en Fábrica Imbabura?", options: ["Telas de poliester", "Telas de algodón", "Telas de poliester y algodón"], correctAnswer: 1, pointsGained: 5, pointsLost: 3, feedback: { correct: "¡Correcto! Eran especialistas en telas de algodón. Ganas 5 puntos.", incorrect: "Incorrecto. La producción principal era de telas de algodón. Pierdes 3 puntos." } },
                '33': { question: "¿En qué cantón está localizada la Fábrica Imbabura?", options: ["Otavalo", "Cotacachi", "Antonio Ante"], correctAnswer: 2, pointsGained: 5, pointsLost: 3, feedback: { correct: "¡Exacto! Se encuentra en Antonio Ante. Ganas 5 puntos.", incorrect: "Incorrecto. La fábrica está en el cantón Antonio Ante. Pierdes 3 puntos." } },
            },
            eventPoints: { // Trampas y Ventajas
                '6': { type: 'trap', text: "¡Oh no! Por la emoción del viaje, se te cayó tu helado. ¡Retrocedes 1 casilla!", move: -1 },
                '12': { type: 'trap', text: "Una densa neblina cubre el mirador y te desorientas por completo. Pierdes 2 puntos.", pointsLost: 2 },
                '17': { type: 'advantage', text: "Descubres un camino menos empinado y tomas un atajo. ¡Avanzas 2 casillas!", move: 2 },
                '22': { type: 'trap', text: "Pierdes tiempo y energía negociando el precio de un poncho. Pierdes 3 puntos.", pointsLost: 3 },
                '29': { type: 'advantage', text: "Llegas a la FÁBRICA IMBABURA, un lugar lleno de historia. ¡Ganas 3 puntos y una muestra de Algodón!", pointsGained: 3, rewardId: 'algodon' },
                '31': { type: 'trap', text: "¡Atrapado en la Maquinaria! Por un descuido, una de las máquinas de la fábrica engancha y destroza tu materia prima.", itemLost: 'algodon' },
            },
            finalMessage: {
                '37': { text: "¡Felicidades, has culminado la Aventura en Imbabura!" }
            }
        };

        // --- ELEMENTOS DEL DOM ---
        const scoreValue = document.getElementById('score-value');
        const videoScreen = document.getElementById('video-screen');
        const mapScreen = document.getElementById('map-screen');
        const modalBackdrop = document.getElementById('registration-modal-backdrop');
        const registrationForm = document.getElementById('registration-form');
        const continueButton = registrationForm.querySelector('button');
        const formInputs = registrationForm.querySelectorAll('input, select');
        const fichaModalBackdrop = document.getElementById('ficha-modal-backdrop');
        const fichaOptions = document.querySelectorAll('.ficha-option');
        const playerFicha = document.getElementById('player-ficha');
        const diceContainer = document.getElementById('dice-container');
        const diceFace = document.getElementById('dice-face');
        const mapZoomContainer = document.getElementById('map-zoom-container');
        const infoModalBackdrop = document.getElementById('info-modal-backdrop');
        const infoModalTitle = document.getElementById('info-modal-title');
        const infoModalImage = document.getElementById('info-modal-image');
        const infoModalDescription = document.getElementById('info-modal-description');
        const infoModalCloseButton = document.getElementById('info-modal-close-button');
        const infoModalReward = document.getElementById('info-modal-reward');
        const rewardModalBackdrop = document.getElementById('reward-modal-backdrop');
        const rewardModalTitle = document.getElementById('reward-modal-title');
        const rewardModalDescription = document.getElementById('reward-modal-description');
        const rewardModalCloseButton = document.getElementById('reward-modal-close-button');
        const rewardModalReward = document.getElementById('reward-modal-reward');
        const questionModalBackdrop = document.getElementById('question-modal-backdrop');
        const questionText = document.getElementById('question-text');
        const questionOptions = document.getElementById('question-options');
        const questionFeedback = document.getElementById('question-feedback');
        const questionContinueButton = document.getElementById('question-continue-button');
        const questionModalReward = document.getElementById('question-modal-reward');
        const eventModalBackdrop = document.getElementById('event-modal-backdrop');
        const eventText = document.getElementById('event-text');
        const eventIconContainer = document.getElementById('event-icon-container');
        const eventModalCloseButton = document.getElementById('event-modal-close-button');
        const scanInstruction = document.querySelector('#info-modal .scan-instruction');

        // Elementos para el modal de admin
const adminLoginTrigger = document.getElementById('admin-login-trigger');
const adminLoginBackdrop = document.getElementById('admin-login-backdrop');
const closeAdminModalBtn = document.getElementById('close-admin-modal-btn');
const adminScreen = document.getElementById('admin-screen');
const backToGameBtn = document.getElementById('back-to-game-btn');

        // --- FUNCIONES DEL JUEGO ---
        function showScreen(screenToShow) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); screenToShow.classList.add('active'); }
        function onYouTubeIframeAPIReady() { player = new YT.Player('youtube-player', { height: '100%', width: '100%', videoId: youtubeVideoId, playerVars: { 'controls': 1, 'modestbranding': 1, 'rel': 0 }, events: { 'onStateChange': onPlayerStateChange } }); }
        function onPlayerStateChange(event) { if (event.data == YT.PlayerState.ENDED && !hasVideoFinished) { hasVideoFinished = true; showScreen(mapScreen); fichaModalBackdrop.style.display = 'flex'; } }
        function validateForm() { let isFormComplete = true; formInputs.forEach(input => { if (!input.value.trim() || (input.tagName === 'SELECT' && input.value === '')) isFormComplete = false; if (input.type === 'number' && (isNaN(parseInt(input.value)) || parseInt(input.value) <= 0)) isFormComplete = false; }); continueButton.disabled = !isFormComplete; }
        function updateScoreUI() { scoreValue.textContent = playerScore; }
        function updateInventoryUI() {
            for (const itemId in playerInventory) {
                const count = playerInventory[itemId];
                const slot = document.getElementById(`item-${itemId}`);
                if (slot) {
                    const countElement = slot.querySelector('.item-count');
                    countElement.textContent = count;
                    slot.classList.toggle('collected', count > 0);
                }
            }
        }

        function openInfoModal(data) {
            infoModalTitle.textContent = data.title;
            infoModalDescription.innerHTML = data.description;
            infoModalImage.src = data.image || '';
            infoModalImage.style.display = data.image ? 'block' : 'none';
            scanInstruction.style.display = data.image ? 'flex' : 'none';

            if (data.rewardId) {
                infoModalReward.querySelector('.reward-icon').src = `icon_${data.rewardId}.png`;
                infoModalReward.style.display = 'flex';
            } else {
                infoModalReward.style.display = 'none';
            }
            infoModalBackdrop.style.display = 'flex';
            setTimeout(() => infoModalBackdrop.classList.add('visible'), 10);
        }

        function openRewardModal(data) {
            rewardModalTitle.textContent = data.title;
            rewardModalDescription.innerHTML = data.description;
            rewardModalReward.querySelector('.reward-icon').src = `icon_${data.rewardId}.png`;
            rewardModalReward.style.display = 'flex';
            rewardModalBackdrop.style.display = 'flex';
            setTimeout(() => rewardModalBackdrop.classList.add('visible'), 10);
        }

        function openQuestionModal(data) {
            questionText.textContent = data.question;
            questionOptions.innerHTML = '';
            questionFeedback.textContent = '';
            questionContinueButton.style.display = 'none';
            questionModalReward.style.display = 'none';

            data.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('option-button');
                button.addEventListener('click', () => checkAnswer(index, data), { once: true });
                questionOptions.appendChild(button);
            });
            questionModalBackdrop.style.display = 'flex';
            setTimeout(() => questionModalBackdrop.classList.add('visible'), 10);
        }

        function openEventModal(data) {
            pendingMove = data.move || 0;
            eventText.textContent = data.text;
            eventModalBackdrop.style.display = 'flex';
            setTimeout(() => eventModalBackdrop.classList.add('visible'), 10);
        }

        function openModalForPoint(position) {
            let data;
            let eventType = null;
            const posStr = String(position);

            if (gameData.infoPoints[posStr]) { eventType = 'info'; data = gameData.infoPoints[posStr]; }
            else if (gameData.rewardPoints[posStr]) { eventType = 'reward'; data = gameData.rewardPoints[posStr]; }
            else if (gameData.questionPoints[posStr]) { eventType = 'question'; data = gameData.questionPoints[posStr]; }
            else if (gameData.eventPoints[posStr]) { eventType = 'event'; data = gameData.eventPoints[posStr]; }
            else if (gameData.finalMessage[posStr]) { eventType = 'final'; data = gameData.finalMessage[posStr]; }

            if (!data) {
                if (!gameOver) {
                    gameActive = true;
                    isRolling = false;
                    diceFace.classList.add('dice-ready');
                }
                return;
            }

            gameActive = false;

            if (data.pointsGained) playerScore += data.pointsGained;
            if (data.pointsLost) playerScore -= data.pointsLost;
            if (data.rewardId && playerInventory.hasOwnProperty(data.rewardId)) {
                playerInventory[data.rewardId]++;
            }
            updateScoreUI();
            updateInventoryUI();

            switch (eventType) {
                case 'info': openInfoModal(data); break;
                case 'reward': openRewardModal(data); break;
                case 'question': openQuestionModal(data); break;
                case 'event': openEventModal(data); break;
                case 'final': triggerEndGameSequence(); break;
            }
        }

        function checkAnswer(selectedIndex, data) {
            const allButtons = questionOptions.querySelectorAll('.option-button');
            const correctIndex = data.correctAnswer;
            allButtons.forEach(button => button.disabled = true);

            if (selectedIndex === correctIndex) {
                allButtons[selectedIndex].classList.add('correct');
                questionFeedback.textContent = data.feedback.correct;
                questionFeedback.style.color = '#2e7d32';
                playerScore += data.pointsGained || 0;
                if (data.rewardId && playerInventory.hasOwnProperty(data.rewardId)) {
                    playerInventory[data.rewardId]++;
                    questionModalReward.querySelector('.reward-icon').src = `icon_${data.rewardId}.png`;
                    questionModalReward.style.display = 'flex';
                }
            } else {
                allButtons[selectedIndex].classList.add('incorrect');
                allButtons[correctIndex].classList.add('correct');
                questionFeedback.textContent = data.feedback.incorrect;
                questionFeedback.style.color = '#c62828';
                playerScore -= data.pointsLost || 0;
            }
            updateScoreUI();
            updateInventoryUI();
            questionContinueButton.style.display = 'inline-block';
        }

        function closeModal(backdrop, rewardElement = null) {
            backdrop.classList.remove('visible');
            setTimeout(() => {
                backdrop.style.display = 'none';
                if (rewardElement) rewardElement.style.display = 'none';

                if (pendingMove !== 0) {
                    const move = pendingMove;
                    pendingMove = 0;
                    animateMovement(playerPosition, move);
                } else if (!gameOver) {
                    gameActive = true;
                    isRolling = false;
                    diceFace.classList.add('dice-ready');
                }
            }, 400);
        }

        function movePlayerFicha(positionIndex, withTransition = true) {
            if (positionIndex >= 0 && positionIndex < path.length) {
                playerFicha.style.transition = withTransition ? 'top 0.25s ease-in-out, left 0.25s ease-in-out' : 'none';
                playerFicha.style.top = path[positionIndex].top;
                playerFicha.style.left = path[positionIndex].left;
            }
        }

        // ======================================================================
        // FUNCIÓN DE MOVIMIENTO REESCRITA PARA MAYOR FIABILIDAD
        // ======================================================================
        function animateMovement(startPos, steps) {
            if (steps === 0) {
                if (!gameOver) {
                    gameActive = true;
                    isRolling = false;
                    diceFace.classList.add('dice-ready');
                }
                return;
            }

            const direction = Math.sign(steps);
            let stepsTaken = 0;
            const totalSteps = Math.abs(steps);

            function moveOneStep() {
                stepsTaken++;
                const currentPosition = startPos + (stepsTaken * direction);

                // Verificación de límites del tablero
                if (currentPosition < 0 || currentPosition >= path.length) {
                    const finalPosition = (direction > 0) ? path.length - 1 : 0;
                    playerPosition = finalPosition;
                    movePlayerFicha(finalPosition);
                    setTimeout(() => openModalForPoint(finalPosition), 300);
                    return;
                }

                // Mover la ficha visualmente y actualizar el estado
                movePlayerFicha(currentPosition);
                playerPosition = currentPosition;

                // Condición de parada: ¿Es el último paso?
                if (stepsTaken >= totalSteps) {
                    // Sí, es el último paso. Activar el evento de la casilla final.
                    setTimeout(() => openModalForPoint(currentPosition), 300);
                } else {
                    // No es el último paso. Revisar si hay que interrumpir.
                    if (gameData.infoPoints[currentPosition]) {
                        // ¡Sí, es un infoPoint! Interrumpir el movimiento.
                        const remainingSteps = (totalSteps - stepsTaken) * direction;
                        pendingMove = remainingSteps;
                        // Abrir el modal para este punto de información.
                        setTimeout(() => openModalForPoint(currentPosition), 400);
                        // NO se llama a moveOneStep de nuevo. El movimiento se reanudará al cerrar el modal.
                    } else {
                        // No hay interrupción, continuar con el siguiente paso.
                        setTimeout(moveOneStep, 1000);
                    }
                }
            }

            moveOneStep(); // Iniciar la animación
        }
        // ======================================================================
        // FIN DE LA FUNCIÓN DE MOVIMIENTO REESCRITA
        // ======================================================================

        function rollDice() {
            if (!gameActive || isRolling || gameOver) return;
            isRolling = true;
            gameActive = false; // Desactivar el juego mientras el dado y la ficha se mueven
            diceFace.classList.remove('dice-ready');

            const rollInterval = setInterval(() => { diceFace.className = `dice-face face-${Math.floor(Math.random() * 6) + 1}`; }, 100);

            setTimeout(() => {
                clearInterval(rollInterval);
                const rollResult = Math.floor(Math.random() * 6) + 1;
                diceFace.className = `dice-face face-${rollResult}`;
                setTimeout(() => animateMovement(playerPosition, rollResult), 500); // Pequeña pausa después de ver el dado
            }, 1000);
        }

        function triggerEndGameSequence() {
            gameOver = true;
            diceContainer.style.display = 'none'; // Ocultar el dado al final
            showScreen(videoScreen);

            if (!player || typeof player.playVideo !== 'function') {
                const finalMessageData = gameData.finalMessage[String(path.length - 1)];
                openEventModal({ text: finalMessageData.text });
                eventModalCloseButton.innerHTML = `Jugar de Nuevo (Puntaje: ${playerScore})`;
                eventModalCloseButton.onclick = () => location.reload();
                return;
            }

            function onFinalVideoEnd(event) {
                if (event.data === YT.PlayerState.ENDED) {
                    showScreen(mapScreen);
                    mapZoomContainer.classList.remove('zoomed-in');
                    const finalMessageData = gameData.finalMessage[String(path.length - 1)];
                    openEventModal({ text: finalMessageData.text });
                    eventModalCloseButton.innerHTML = `Jugar de Nuevo (Puntaje: ${playerScore})`;
                    eventModalCloseButton.onclick = () => location.reload();
                    player.removeEventListener('onStateChange', onFinalVideoEnd);
                }
            }
            player.addEventListener('onStateChange', onFinalVideoEnd);
            player.seekTo(0);
            player.playVideo();
        }

        // --- INICIALIZACIÓN ---
        registrationForm.addEventListener('input', validateForm);
        registrationForm.addEventListener('submit', (e) => { e.preventDefault(); modalBackdrop.style.display = 'none'; showScreen(videoScreen); if (player && typeof player.playVideo === 'function') { player.playVideo().catch(() => { player.mute(); player.playVideo(); }); } registrationForm.reset(); validateForm(); });

        fichaOptions.forEach(option => {
            option.addEventListener('click', () => {
                playerFicha.style.backgroundImage = `url('${option.src}')`;
                playerFicha.style.display = 'block';
                playerPosition = 0;
                movePlayerFicha(playerPosition, false); // Posicionamiento inicial sin animación
                fichaModalBackdrop.style.display = 'none';
                setTimeout(() => {
                    mapZoomContainer.classList.add('zoomed-in');
                    gameActive = true; isRolling = false; diceFace.classList.add('dice-ready');
                }, 500);
            });
        });

        
        // --- Eventos para el Modal de Administrador ---
adminLoginTrigger.addEventListener('click', (e) => {
    e.preventDefault(); // Previene el salto de página por el href="#"
    adminLoginBackdrop.style.display = 'flex';
    setTimeout(() => adminLoginBackdrop.classList.add('visible'), 10);
});

closeAdminModalBtn.addEventListener('click', () => {
    adminLoginBackdrop.classList.remove('visible');
    setTimeout(() => adminLoginBackdrop.style.display = 'none', 400);
});

// Opcional: Cierra el modal si se hace clic en el fondo oscuro
adminLoginBackdrop.addEventListener('click', (e) => {
    if (e.target === adminLoginBackdrop) {
        adminLoginBackdrop.classList.remove('visible');
        setTimeout(() => adminLoginBackdrop.style.display = 'none', 400);
    }
});

        infoModalCloseButton.addEventListener('click', () => closeModal(infoModalBackdrop, infoModalReward));
        rewardModalCloseButton.addEventListener('click', () => closeModal(rewardModalBackdrop, rewardModalReward));
        questionContinueButton.addEventListener('click', () => closeModal(questionModalBackdrop, questionModalReward));
        eventModalCloseButton.addEventListener('click', () => closeModal(eventModalBackdrop));
        diceFace.addEventListener('click', rollDice);

        document.addEventListener('DOMContentLoaded', () => {
            modalBackdrop.style.display = 'flex';
            validateForm();
            updateScoreUI();
            updateInventoryUI();
        });



    // --- Lógica para el Formulario de Login de Administrador (Método Inseguro) ---
const adminLoginForm = document.getElementById('admin-login-form');
const ADMIN_EMAIL = "admin@aventura.com";
const ADMIN_PASS = "ImbaburaSecreto123";

adminLoginForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const emailInput = document.getElementById('admin-email').value;
    const passwordInput = document.getElementById('admin-password').value;

    if (emailInput === ADMIN_EMAIL && passwordInput === ADMIN_PASS) {
        // Ocultamos el modal de login
        adminLoginBackdrop.classList.remove('visible');
        setTimeout(() => adminLoginBackdrop.style.display = 'none', 400);
        adminLoginForm.reset();
        
        // MOSTRAMOS LA PANTALLA DE ADMIN Y CARGAMOS LOS DATOS
        showScreen(document.getElementById('admin-screen'));
        fetchAndDisplayRegistrations();

    } else {
        alert('Credenciales incorrectas. Inténtalo de nuevo.');
    }
});


// --- Función para cargar y mostrar los datos de registro ---
async function fetchAndDisplayRegistrations() {
    const tbody = document.getElementById('registros-tbody');
    const loadingMessage = document.getElementById('loading-message');
    const db = firebase.firestore(); // Asegúrate que Firebase está inicializado
    
    // Mostramos "Cargando..." cada vez que se llama a la función
    tbody.innerHTML = '';
    loadingMessage.textContent = 'Cargando datos desde Firebase...';
    loadingMessage.style.display = 'block';
    
    try {
        const snapshot = await db.collection('registrations').get();
        
        if (snapshot.empty) {
            loadingMessage.textContent = 'No se encontraron registros de jugadores.';
            return;
        }

        snapshot.forEach(doc => {
            const playerData = doc.data();
            const row = `
                <tr>
                    <td>${playerData.cedula || 'N/A'}</td>
                    <td>${playerData.nombre || 'N/A'}</td>
                    <td>${playerData.edad || 'N/A'}</td>
                    <td>${playerData.genero || 'N/A'}</td>
                    <td>${playerData.ciudad || 'N/A'}</td>
                    <td>${playerData.email || 'N/A'}</td>
                    <td>${playerData.telefono || 'N/A'}</td>
                </tr>
            `;
            tbody.innerHTML += row;
        });

        loadingMessage.style.display = 'none';

    } catch (error) {
        console.error("Error al cargar los registros: ", error);
        loadingMessage.textContent = 'Error al cargar los datos. Revisa la consola.';
    }
}
    </script>
</body>

</html>